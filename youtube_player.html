<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Telegram Mini App - YouTube 播放器</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { background: #20232a; color: #fff; font-family: "Noto Sans TC", Arial, sans-serif; margin:0;}
    .container { max-width:480px; margin:15px auto 0; padding:1.4em .9em;}
    h1 {font-size: 1.5em; text-align: center; margin:.6em 0;}
    #desc { color: #89a; font-size:.95em; text-align:center;}
    #loader {margin:2em 0; text-align:center;}
    iframe { width:100%; max-width:430px; min-height:245px; border:none; border-radius:8px; background:#111;}
    #back-btn {margin:1.7em auto .5em auto; background:#3586ff; color:#fff; padding:.75em 2em; border-radius:7px; border:none; font-size:1em;cursor:pointer; display:none;}
    #back-btn:hover {background:#2466ca;}
    #error-info {display:none; color:#ff5252; text-align:center; margin:1.5em 0;}
    #vid-thumb {max-width:92%;border-radius:10px;display:none; margin:.5em auto;}
    #footer { color: #89a; font-size:.95em; margin-top:1.5em; text-align:center;}
  </style>
</head>
<body>
  <div class="container">
    <h1>🎬 Telegram YouTube 播放器</h1>
    <div id="desc">Mini App 直接播放 YouTube 音樂/影片，支援行動裝置</div>
    <div id="vid-title"></div>
    <img id="vid-thumb">
    <div id="loader">🔄 載入中，請稍候...</div>
    <iframe id="ytplayer" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    <div id="error-info">⚠️ 此影片無法於本頁播放，<a id="yt-link" target="_blank">請點這裡於 YouTube 開啟</a></div>
    <button id="back-btn" onclick="goBack()">返回 Telegram</button>
    <div id="footer">© 2025 E7P 播放器團隊｜僅供教學使用</div>
  </div>
  <script>
    const params = new URLSearchParams(window.location.search);
    const videoId = params.get("video_id");
    if(videoId && /^[\w-]{11}$/.test(videoId)){
      document.getElementById("ytplayer").src = `https://www.youtube.com/embed/${videoId}?autoplay=1&hl=zh-TW`;
      document.getElementById("yt-link").href = `https://www.youtube.com/watch?v=${videoId}`;
      document.getElementById("vid-thumb").src = `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`;
      document.getElementById("vid-thumb").style.display = '';
      document.getElementById("vid-title").innerText = ""; // 可透過 query 參數帶入標題
    }else{
      document.getElementById('loader').style.display="none";
      document.getElementById('error-info').style.display="";
      document.getElementById('error-info').innerHTML = "❌ 無效的影片 ID！";
      document.getElementById('ytplayer').style.display="none";
    }
    // 處理載入完成與錯誤
    const ytframe = document.getElementById('ytplayer');
    ytframe.onload = function() { document.getElementById('loader').style.display='none'; }
    ytframe.onerror = function() {
      document.getElementById('loader').style.display="none";
      document.getElementById('error-info').style.display="";
    };
    // 返回 Telegram 按鈕僅於 WebApp 內顯示
    function goBack(){
      if(window.Telegram && Telegram.WebApp){ Telegram.WebApp.close(); }
      else{ window.open("https://t.me/"); }
    }
    if(window.Telegram && Telegram.WebApp){
      document.getElementById('back-btn').style.display='';
    }
  </script>
</body>
</html>
