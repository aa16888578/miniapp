<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch 直播播放器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0f23;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        .stream-container {
            flex: 1;
            width: 100%;
            position: relative;
            min-height: 50vh;
        }

        .stream-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
        }

        .chat-container {
            flex: 1;
            width: 100%;
            position: relative;
            min-height: 50vh;
        }

        .chat-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: #18181b;
        }

        /* 移動設備優化 */
        @media (max-width: 768px) {
            .stream-container {
                flex: 1.2;
            }

            .chat-container {
                flex: 0.8;
            }
        }

        /* 防止螢幕保護程式啟動 */
        .keep-awake {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 直播視窗區域 -->
        <div class="stream-container">
            <iframe 
                class="stream-frame"
                src="https://player.twitch.tv/?channel=CHANNEL_NAME&parent=YOUR_DOMAIN&autoplay=true&controls=false"
                allowfullscreen>
            </iframe>
        </div>

        <!-- 聊天室區域 -->
        <div class="chat-container">
            <iframe 
                class="chat-frame"
                src="https://www.twitch.tv/embed/CHANNEL_NAME/chat?parent=YOUR_DOMAIN&darkpopout">
            </iframe>
        </div>
    </div>

    <!-- 保持喚醒的隱藏視頻元素 -->
    <video class="keep-awake" muted loop autoplay>
        <source src="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAwW1kYXQAAAGzABAHAAABthADAowdbb9/AAAC6ZJqCGzRf8p9lAAACQpJREFUKJHt..." type="video/mp4">
    </video>

    <script>
        // 背景播放核心功能 - 防止自動暫停
        (function() {
            'use strict';

            // 重寫 Page Visibility API
            const originalVisibilityState = Object.getOwnPropertyDescriptor(Document.prototype, 'visibilityState');
            const originalHidden = Object.getOwnPropertyDescriptor(Document.prototype, 'hidden');

            Object.defineProperty(document, 'visibilityState', {
                get: function() {
                    return 'visible';
                },
                configurable: true
            });

            Object.defineProperty(document, 'hidden', {
                get: function() {
                    return false;
                },
                configurable: true
            });

            // 阻止 visibilitychange 事件
            const originalAddEventListener = document.addEventListener;
            document.addEventListener = function(type, listener, options) {
                if (type === 'visibilitychange') {
                    return;
                }
                return originalAddEventListener.call(this, type, listener, options);
            };

            // 阻止 blur 和 pagehide 事件
            const originalWindowAddEventListener = window.addEventListener;
            window.addEventListener = function(type, listener, options) {
                if (type === 'blur' || type === 'pagehide' || type === 'beforeunload') {
                    return;
                }
                return originalWindowAddEventListener.call(this, type, listener, options);
            };

            // 防止自動暫停的定期檢查
            setInterval(function() {
                // 觸發活動狀態
                const activeEvent = new Event('mousemove');
                document.dispatchEvent(activeEvent);

                // 保持音頻上下文活躍
                if (window.AudioContext || window.webkitAudioContext) {
                    try {
                        const context = new (window.AudioContext || window.webkitAudioContext)();
                        if (context.state === 'suspended') {
                            context.resume();
                        }
                    } catch (e) {}
                }
            }, 30000);

            // Wake Lock API 支援（如果可用）
            if ('wakeLock' in navigator) {
                let wakeLock = null;

                const requestWakeLock = async () => {
                    try {
                        wakeLock = await navigator.wakeLock.request('screen');
                        console.log('螢幕保持喚醒已啟用');
                    } catch (err) {
                        console.log('無法啟用螢幕保持喚醒:', err);
                    }
                };

                requestWakeLock();

                // 在可見性變化時重新請求
                document.addEventListener('visibilitychange', () => {
                    if (wakeLock !== null && document.visibilityState === 'visible') {
                        requestWakeLock();
                    }
                });
            }

            // 移動設備特殊處理
            if (/Mobi|Android/i.test(navigator.userAgent)) {
                // 防止觸摸時暫停
                document.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                }, { passive: false });

                document.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                }, { passive: false });
            }

            // 頁面載入完成後初始化
            window.addEventListener('load', function() {
                // 替換頻道名稱和域名
                const streamFrame = document.querySelector('.stream-frame');
                const chatFrame = document.querySelector('.chat-frame');

                // 從 URL 參數獲取頻道名稱
                const urlParams = new URLSearchParams(window.location.search);
                const channel = urlParams.get('channel') || 'twitch';
                const domain = window.location.hostname;

                // 更新 iframe src
                streamFrame.src = streamFrame.src.replace('CHANNEL_NAME', channel).replace('YOUR_DOMAIN', domain);
                chatFrame.src = chatFrame.src.replace('CHANNEL_NAME', channel).replace('YOUR_DOMAIN', domain);

                console.log('Twitch 播放器已優化 - 背景播放已啟用');
            });

            // 阻止右鍵菜單（可選）
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });

            // 阻止特定鍵盤快捷鍵
            document.addEventListener('keydown', function(e) {
                // 阻止 F5 重新整理
                if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                    e.preventDefault();
                }
                // 阻止 Ctrl+Shift+I 開發者工具
                if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                    e.preventDefault();
                }
            });
        })();
    </script>
</body>
</html>
